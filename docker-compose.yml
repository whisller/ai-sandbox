# Base docker-compose configuration for Claude Code
# Zero-configuration setup - automatically reads git config from host
#
# Usage:
#   docker-compose -f docker-compose.yml -f docker-compose.ssh.yml run --rm claude

services:
  claude:
    build:
      context: .
      dockerfile: Dockerfile.claude
    image: ai-sandbox:claude
    container_name: ai-sandbox
    stdin_open: true
    tty: true
    working_dir: ${AI_SANDBOX_WORKSPACE_PATH}

    # Mount your workspace and git config
    volumes:
      # Workspace - mounted at same path as host (docker sandbox behavior)
      - ${AI_SANDBOX_WORKSPACE_PATH}:${AI_SANDBOX_WORKSPACE_PATH}

      # Mount host's .gitconfig to read user.name and user.email
      - ${HOME}/.gitconfig:/host-gitconfig:ro

      # Persist Claude config (including auth token) across container restarts
      - ai-sandbox-config:/home/agent/.config

    # Restart policy
    restart: unless-stopped

# Named volumes for persistent data
volumes:
  ai-sandbox-config:
